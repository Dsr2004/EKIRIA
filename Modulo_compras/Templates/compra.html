{%extends 'Menu_Usuario.html'%} {% block head %}

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>compras</title>
    <link rel="stylesheet" href="/static/Modulo_compras/css/style.css">
    <link rel="icon" href="/static/Proyecto_Ekiria/Img/Logo Ekiria.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vast+Shadow&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/Proyecto_Ekiria/css/styleTablesInformations.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css">
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="sweetalert2.min.css">
    <script src="/static/bootstrap/js/bootstrap.js"></script>


</head>
{% endblock head %} {% block Contenido %}



<div class="container">



    <div class="Table Content-table">
        <div class="Information">
            <div class="cardHeader">
                <h2>compras</h2>
            </div>
            <div class="Table Add">
                <button class="pdf img btn btn-dribbble">
                    <a href="" style="color: #fff;">
                        <i class="mdi mdi-file-pdf"></i>
                        <b class="etiquetaReporte" style="display: none;">Reporte</b>
                    </a>
                </button>
                <button type="button" class="Add img btn btn-bordred">
                  <a href="{%url 'crearcompra'%}" style="color:black;">
                    <i class="fas fa-user-plus"></i>
                    <b class="etiquetaCrearCompra" style="display: none;">Crear Compra</b>
                    </a>
                </button>
            </div>
            <table id="TablaCompra">
                <thead>
                    <tr>
                        <th scope="col">Fecha de creación</th>
                        <th scope="col">Estado</th>
                        <th scope="col">Valor Total</th>
                        <th scope="col">Detalle</th>
                    </tr>
                </thead>
                <tbody>

                    {% for compra in Compras %}
                    <tr>
                        <td>{{compra.fecha_creacion}}</td>
                        <td>
                            <div class="form-switch" class="Swictder">
                                <form action="{%url 'camestadoCompra'%}" method="POST" id="CambioEC">
                                    {%csrf_token%}
                                    <input class="form-check-input" type="checkbox" id="flexSwitchCheckChecked" {%if compra.estado %} checked {%endif%} onclick="CambioEstadoCompra('{{compra.pk}}')">
                                </form>
                            </div>
                        </td>
                        <td>{{compra.total}}</td>
                        <td><i class="mdi mdi-file-document" style="cursor:pointer;" onclick="verDetalle('{{compra.pk}}')"></i></td>
                    </tr>
                    <script>
                        function CambioEstadoCompra(id) {
                            let token = $("#CambioEC").find('input[name=csrfmiddlewaretoken]').val()
                            swal.fire({
                                title: '¿Estás seguro de cambiar el estado de esta compra?',
                                text: "{%if compra.estado %}Al inhabilitar esta compra no se podrá sacar el reporte y la cantidad de productos se verá alterada por la cantidad agregada en esta compra{%else%}Al habilitar esta compra se repondrán la cantidad productos agregados en esta compra{%endif%}",
                                icon: 'warning',
                                showCancelButton: true,
                                confirmButtonText: 'Si, estoy seguro',
                                cancelButtonText: 'No, cancelar!',
                                reverseButtons: true,
                            }).then((willDelete) => {
                                if (willDelete.isConfirmed) {
                                    $.ajax({
                                        data: {
                                            "csrfmiddlewaretoken": token,
                                            "estado": id
                                        },
                                        url: $("#CambioEC").attr('action'),
                                        type: $("#CambioEC").attr('method'),
                                        success: function(data) {
                                            swal.fire("Se ha modificado el estado de la compra", {
                                                icon: 'success',
                                            }).then(function() {
                                                location.reload()
                                            });
                                        },
                                        error: function(error) {
                                            Error = error['responseJSON']
                                            let mensaje = Error['error']
                                            Swal.fire({
                                                icon: 'info',
                                                title: 'Atención.',
                                                text: mensaje + '.',
                                                willClose: () => {
                                                    location.reload()
                                                }
                                            })
                                        }
                                    });

                                } else {
                                    location.reload()
                                }
                            });
                        }
                    </script>
                    {% endfor %}

                </tbody>
            </table>
        </div>
    </div>
</div>



{% endblock Contenido %} {% block modal %}

<div class="modal fade" id="agregar_comp" role="dialog">

</div>

{% endblock modal%} {%block scripts%}
<script>
    $(document).ready(function() {
        $('#TablaCompra').DataTable({
            "language": {
                "url": "//cdn.datatables.net/plug-ins/1.10.16/i18n/Spanish.json"
            },
            responsive: true
        });
    });

    function verDetalle(id) {
        window.location.href = "../VerDetalleCompra/" + id;
    }
</script>
<script src="/static/Proyecto_Ekiria/js/jsMenuL.js"></script>
<script src="/static/Modulo_compras/js/js.js"></script>
<script src="sweetalert2.all.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
{%endblock scripts%}

</html>