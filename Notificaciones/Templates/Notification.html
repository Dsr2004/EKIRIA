{% extends "Menu_Usuario.html" %} 
{% load humanize %}
{% load static %}
{% block head %}

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notificaciones</title>
    <link rel="stylesheet" href="{% static 'Notificaciones/css/styleNotifications.css' %}">
    <link rel="stylesheet" href="{% static 'Proyecto_Ekiria/css/styleTablesInformations.css' %}"> 
    {% endblock head %}
</head>
{% block Contenido %}
{% if messages %}
    {% for me in messages %}
    <div class="container alert alert-primary  alert-dismissible fade show" role="alert">
         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-exclamation-triangle-fill flex-shrink-0 me-2" viewBox="0 0 16 16" role="img" aria-label="Warning:">
           <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
         </svg>
      {{me}}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div> 
    {% endfor %}
    <br>
    <script>
        $(document).ready(function(){
            window.setTimeout(function () { 
                $(".alert").alert('close'); 
             }, 3000);             
        })
    </script>
{% endif %}
<div class="Table Content-table" style="margin-top: -40px !important;">
    <div class="Information">
        <div class="row">
            <div class="col-10"> 
                <div class="cardHeader"><h2>Notificaciones</h2></div>
            </div>
            <div class="col-2" style="margin-top: 20px !important;">
                <form action="{% url 'Notify' %}" method="post"id="FormFilter">
                    {% csrf_token %}
                    <input type="hidden" name="tipo" value="">
                </form>
                <div class="dropdown">
                    <button class="btn btn-ligth dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                        <i style="transform: scale(1.5);" class="fa-solid fa-gear"></i>
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                      <li><a class="btn dropdown-item" onclick="filtrarNotificacion('leido')">Leidos</a></li>
                      <li><a class="btn dropdown-item" onclick="filtrarNotificacion('Noleido')">No leidos</a></li>
                      <li><a class="btn dropdown-item" href="{% url 'Notify' %}">Mostrar todos</a></li>
                    </ul>
                  </div>
            </div>
        </div>
       
            
        </div>
        {% if notificaciones %}
            <div class="col-12 principal_notify">
                {% for notificacion in notificaciones %}
                <div class="row notification notification{{ forloop.counter }}">
                <div class="col-1" style="margin-top: 10px;">
                {% if notificacion.actor_content_type.app_label == "Usuarios" %}
                <div class="img_user_notification usuarios">
                        <i class="fa-solid fa-users"></i>
                </div>
                {% endif %}
                {% if notificacion.actor_content_type.app_label == "Modulo_compras" %}
                <div class="img_user_notification compras">
                    <i class="fa-solid fa-box-archive"></i>
                </div>
                {% endif %}
                {% if notificacion.actor_content_type.app_label == "Ventas" %}
                <div class="img_user_notification ventas">
                        <i class="fa-solid fa-cart-shopping"></i>
                </div>
                {% endif %}
                {% if notificacion.actor_content_type.app_label == "Configuracion" %}
                <div class="img_user_notification configuracion">
                        <i class="fa-solid fa-gears"></i>
                </div>
                {% endif %}
                {% if notificacion.actor_content_type.app_label == "Notificaciones" %}
                <div class="img_user_notification notificacion">
                    <i class="fa-solid fa-bell"></i>
                </div>
                {% endif %}
                </div>
                <div class="col-9 verb_notification">{{notificacion.verbo}}</div>
                <div class="col-2" id="actions{{ forloop.counter }}" style="display: none;">
                    <div class="row actions">
                        <div class="col-3">
                            <button onclick="BorrarNotificacion('{% url 'DeleteNotify' notificacion.id_notificacion %}')" class="btn btn-sm btn-danger"><i class="fa-solid fa-trash" ></i></button>
                        </div>  
                        <div class="col-3" class="actions-read-status">
                            <form action="{% url 'ChangeStatus' %}" method="POST">
                                {% csrf_token %}
                                <input type="hidden" name="id" value="{{notificacion.id_notificacion}}">
                            {% if notificacion.leido %}
                                <button type="submit" class="btn btn-sm btn-outline-success" ><i class="fa-solid fa-eye"></i></button>
                            {% else %}
                            <button type="submit" class="btn btn-sm btn-outline-primary" ><i class="fa-solid fa-eye-slash"></i></button>
                            {% endif %}
                            </form>
                           
                        </div>
                    </div>
                </div>
                <div class="timespan_notification">
                    <span class="badge badge-pill badge-light">
                        Hace {{notificacion.fecha|timesince|naturaltime}}
                    </span>
                </div>
            </div>
                <script>
                    $(".notification{{ forloop.counter }}").mouseenter(function(){
                        $("#actions{{ forloop.counter }}").css("display","block")
                    })
                    $(".notification{{ forloop.counter }}").mouseleave(function(){
                        $("#actions{{ forloop.counter }}").css("display","none")
                    })
                
                    
                </script>
                    
            {% endfor %}
            </div>
            {% else %}
            <h1>Usted no tiene notificaciones</h1>
        {% endif %}

    </div>
</div>

{% endblock Contenido %}
{% block scripts %}
  <script src="{% static 'Notificaciones/js/notificaciones.js' %}"></script>
{% endblock scripts %}